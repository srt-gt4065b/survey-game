"use strict";(self.webpackChunkgamified_survey_system=self.webpackChunkgamified_survey_system||[]).push([[979],{979:(e,s,a)=>{a.r(s),a.d(s,{default:()=>v});var t=a(555),n=a(43),l=a(472),i=a(335),c=a(177),r=a(579);const o=e=>{let{question:s,questionNumber:a,totalQuestions:t,overallNumber:l,overallTotal:i,chapterNumber:c,chapterName:o,sectionIndex:d,sectionTotal:m,onAnswer:u,onBack:v,onSkip:h}=e;const[x,p]=(0,n.useState)(""),{text:j,type:N,options:g,section:b}=s,f="likert"===N?["\ud83d\ude0d Strongly Agree","\ud83d\ude42 Agree","\ud83d\ude10 Neutral","\ud83d\ude15 Disagree","\ud83d\ude21 Strongly Disagree"]:(y=g)?Array.isArray(y)?y:"string"===typeof y?y.includes(",")?y.split(",").map(e=>e.trim()).filter(Boolean):y.includes("|")?y.split("|").map(e=>e.trim()).filter(Boolean):[y.trim()]:[]:[];var y;return(0,r.jsxs)("div",{className:"question-card fade-in",children:[(0,r.jsxs)("div",{className:"q-header",children:[(0,r.jsxs)("div",{className:"chapter-label",children:[(0,r.jsxs)("span",{className:"chapter-index",children:["Section ",c,"."]}),(0,r.jsx)("span",{className:"chapter-name",children:o})]}),(0,r.jsx)("div",{className:"q-progress-group",children:(0,r.jsxs)("div",{className:"q-progress-section",children:[d," / ",m]})})]}),(0,r.jsx)("h2",{className:"q-text",children:j}),"multi"===N&&(0,r.jsx)("div",{className:"q-options",children:f.map((e,s)=>(0,r.jsxs)("button",{className:"q-option ".concat(x===e?"selected":""),onClick:()=>p(e),children:[(0,r.jsx)("span",{className:"option-number",children:s+1}),(0,r.jsx)("span",{className:"option-text",children:e})]},s))}),"likert"===N&&(0,r.jsx)("div",{className:"q-options",children:f.map((e,s)=>(0,r.jsx)("button",{className:"q-option ".concat(x===e?"selected":""),onClick:()=>p(e),children:e},s))}),"text"===N&&(0,r.jsx)("textarea",{className:"q-textarea",placeholder:"Write your answer...",value:x,onChange:e=>p(e.target.value)}),(0,r.jsxs)("div",{className:"q-footer",children:[(0,r.jsxs)("button",{className:"back-btn",onClick:v,children:[(0,r.jsx)("span",{className:"btn-icon",children:"\u2190"}),(0,r.jsx)("span",{className:"btn-text",children:"Back"})]}),(0,r.jsxs)("button",{className:"skip-btn",onClick:h,children:[(0,r.jsx)("span",{className:"btn-icon",children:"\u23ed"}),(0,r.jsx)("span",{className:"btn-text",children:"Skip"})]}),(0,r.jsxs)("button",{className:"next-btn ".concat(x?"active":""),disabled:!x,onClick:()=>{x&&(u(x),p(""))},children:[(0,r.jsx)("span",{className:"btn-text",children:"Next"}),(0,r.jsx)("span",{className:"btn-icon",children:"\u2192"})]})]})]})},d=e=>{let{overallProgress:s}=e;const{user:a,gameStats:t}=(0,c.A)();return(0,r.jsxs)("div",{className:"game-header",children:[(0,r.jsxs)("div",{className:"user-info-section",children:[(0,r.jsx)("div",{className:"user-avatar",children:(null===a||void 0===a?void 0:a.avatar)||"\ud83c\udf93"}),(0,r.jsxs)("div",{className:"user-details",children:[(0,r.jsx)("div",{className:"user-name",children:(null===a||void 0===a?void 0:a.name)||"Student"}),(0,r.jsxs)("div",{className:"user-meta",children:[(null===a||void 0===a?void 0:a.studentId)&&(0,r.jsxs)("span",{children:["ID: ",a.studentId]}),(null===a||void 0===a?void 0:a.department)&&(0,r.jsx)("span",{className:"user-dept",children:a.department})]})]})]}),s&&(0,r.jsxs)("div",{className:"overall-progress-section",children:[(0,r.jsxs)("div",{className:"progress-text",children:["Overall Progress: ",s.current," / ",s.total]}),(0,r.jsx)("div",{className:"progress-bar-container",children:(0,r.jsx)("div",{className:"progress-bar-fill",style:{width:"".concat(s.current/s.total*100,"%")}})})]}),(0,r.jsxs)("div",{className:"stats-row",children:[(0,r.jsxs)("div",{className:"stat-box",children:[(0,r.jsx)("div",{className:"stat-icon",children:"\u2b50"}),(0,r.jsx)("div",{className:"stat-value",children:(null===t||void 0===t?void 0:t.level)||1}),(0,r.jsx)("div",{className:"stat-label",children:"Level"})]}),(0,r.jsxs)("div",{className:"stat-box",children:[(0,r.jsx)("div",{className:"stat-icon",children:"\ud83d\udcaf"}),(0,r.jsx)("div",{className:"stat-value",children:(null===t||void 0===t?void 0:t.experience)||0}),(0,r.jsx)("div",{className:"stat-label",children:"EXP"})]}),(0,r.jsxs)("div",{className:"stat-box",children:[(0,r.jsx)("div",{className:"stat-icon",children:"\ud83d\udd25"}),(0,r.jsx)("div",{className:"stat-value",children:(null===t||void 0===t?void 0:t.streak)||0}),(0,r.jsx)("div",{className:"stat-label",children:"Streak"})]}),(0,r.jsxs)("div",{className:"stat-box",children:[(0,r.jsx)("div",{className:"stat-icon",children:"\ud83e\ude99"}),(0,r.jsx)("div",{className:"stat-value",children:(null===t||void 0===t?void 0:t.coins)||0}),(0,r.jsx)("div",{className:"stat-label",children:"Coins"})]})]})]})};function m(e){let{onComplete:s}=e;return(0,r.jsxs)("div",{className:"end-scene",children:[(0,r.jsx)("h1",{children:"\ud83c\udf89 Great Job!"}),(0,r.jsx)("p",{children:"Your survey game mission has been successfully completed!!."}),(0,r.jsx)("button",{className:"end-btn",onClick:s,children:"\ub9ac\ub354\ubcf4\ub4dc \ubcf4\uae30 \u2192"}),(0,r.jsx)("button",{className:"home-btn",onClick:()=>window.location.reload(),children:"\ucc98\uc74c\uc73c\ub85c \ub3cc\uc544\uac00\uae30"})]})}var u=a(339);const v=e=>{var s,a;let{onComplete:v}=e;const{user:h,answerQuestion:x}=(0,c.A)(),[p,j]=(0,n.useState)([]),[N,g]=(0,n.useState)(!0),[b,f]=(0,n.useState)(""),[y,k]=(0,n.useState)(0),[w,S]=(0,n.useState)({}),[A,q]=(0,n.useState)(Date.now()),[C,I]=(0,n.useState)(!1),D=(null===h||void 0===h?void 0:h.language)||"en";(0,n.useEffect)(()=>{(async()=>{try{g(!0);const e=(0,l.P)((0,l.rJ)(i.db,"questions"),(0,l.My)("id")),s=(await(0,l.GG)(e)).docs.map(e=>(0,t.A)({docId:e.id},e.data()));j(s),s.length>0&&f(s[0].category)}catch(e){u.Ay.error("Failed to load questions")}finally{g(!1),q(Date.now())}})()},[]);const O=(0,n.useMemo)(()=>[...new Set(p.map(e=>e.category))],[p]),B=(0,n.useMemo)(()=>p.filter(e=>e.category===b),[p,b]),P=B.length>0?B[y]:null,M=(0,n.useMemo)(()=>({current:Object.keys(w).length,total:p.length}),[w,p.length]),_=B.length,G=y+1,T=O.indexOf(b)+1;if(C)return(0,r.jsx)(m,{onComplete:v});if(N)return(0,r.jsx)("div",{className:"loading",children:"Loading\u2026"});if(!P)return(0,r.jsx)("div",{children:"No questions available"});const E={text:(null===(s=P.text)||void 0===s?void 0:s[D])||(null===(a=P.text)||void 0===a?void 0:a.en),section:b,type:P.type,options:(J=P.options,J?Array.isArray(J)?J:J.split(/[\|,]/).map(e=>e.trim()).filter(e=>e.length>0):[]),required:!0};var J;return(0,r.jsxs)("div",{className:"survey-container",children:[(0,r.jsx)(d,{overallProgress:M}),(0,r.jsx)(o,{question:E,chapterNumber:T,chapterName:b,sectionIndex:G,sectionTotal:_,onBack:()=>{if(y>0)return void k(e=>e-1);const e=O.indexOf(b);if(e>0){const s=O[e-1],a=p.filter(e=>e.category===s);f(s),k(a.length-1)}},onAnswer:e=>{if(!P)return;const s=(Date.now()-A)/1e3,a=P.docId;S(n=>(0,t.A)((0,t.A)({},n),{},{[a]:{value:e,timeSpent:s}})),x(s,"good");const n=y+1;if(n<B.length)return k(n),void q(Date.now());const l=new Set(Object.keys((0,t.A)((0,t.A)({},w),{},{[a]:!0}))),i=O.filter(e=>p.some(s=>s.category===e&&!l.has(s.docId)));if(i.length>0)return f(i[0]),k(0),void q(Date.now());I(!0)},onSkip:()=>{const e=P.docId;S(s=>(0,t.A)((0,t.A)({},s),{},{[e]:{value:null,skipped:!0}}));const s=y+1;if(s<B.length)return k(s),void q(Date.now());const a=new Set(Object.keys((0,t.A)((0,t.A)({},w),{},{[e]:!0}))),n=O.filter(e=>p.some(s=>s.category===e&&!a.has(s.docId)));if(n.length>0)return f(n[0]),k(0),void q(Date.now());I(!0)}},P.docId)]})}}}]);
//# sourceMappingURL=979.116da0d8.chunk.js.map