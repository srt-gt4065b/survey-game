"use strict";(self.webpackChunkgamified_survey_system=self.webpackChunkgamified_survey_system||[]).push([[471],{471:(e,s,a)=>{a.r(s),a.d(s,{default:()=>m});var t=a(555),l=a(43),n=a(472),i=a(335),r=a(177),c=a(579);const o=e=>{let{question:s,questionNumber:a,totalQuestions:t,overallNumber:n,overallTotal:i,onAnswer:r,onSkip:o,onBack:d,onJump:u}=e;const[v,m]=(0,l.useState)(""),{text:h,type:x,options:j,section:N}=s,g="likert"===x?["\ud83d\ude0d Strongly Agree","\ud83d\ude42 Agree","\ud83d\ude10 Neutral","\ud83d\ude15 Disagree","\ud83d\ude21 Strongly Disagree"]:(e=>e?Array.isArray(e)?e:e.split(/[\|,]/g).map(e=>e.trim()).filter(e=>e.length>0):[])(j);return(0,c.jsxs)("div",{className:"question-card fade-in",children:[(0,c.jsxs)("div",{className:"q-header",children:[(0,c.jsxs)("div",{className:"q-section",children:["Section ",N]}),(0,c.jsxs)("div",{className:"q-progress-group",children:[(0,c.jsxs)("div",{className:"q-progress-chapter",children:[a," / ",t]}),(0,c.jsxs)("div",{className:"q-progress-overall",children:["Overall: ",n," / ",i]})]})]}),(0,c.jsx)("h2",{className:"q-text",children:h}),("multi"===x||"single"===x||"likert"===x)&&g.length>0&&(0,c.jsx)("div",{className:"q-options",children:g.map((e,s)=>(0,c.jsx)("button",{className:"q-option ".concat(v===e?"selected":""),onClick:()=>m(e),children:e},s))}),"text"===x&&(0,c.jsx)("textarea",{className:"q-textarea",placeholder:"Write your answer...",value:v,onChange:e=>m(e.target.value)}),(0,c.jsxs)("div",{className:"q-footer",children:[(0,c.jsx)("button",{className:"back-btn",onClick:d,children:"\u2190 Back"}),(0,c.jsx)("button",{className:"skip-btn",onClick:()=>o(),children:"\u23ed Skip"}),(0,c.jsx)("button",{className:"jump-btn",onClick:()=>u(),children:"\u279f Jump"}),(0,c.jsx)("button",{className:"next-btn ".concat(v?"active":""),disabled:!v,onClick:()=>{v&&(r(v),m(""))},children:"Next \u2192"})]})]})},d=e=>{let{overallProgress:s}=e;const{user:a,gameStats:t}=(0,r.A)();return(0,c.jsxs)("div",{className:"game-header",children:[(0,c.jsxs)("div",{className:"user-info-section",children:[(0,c.jsx)("div",{className:"user-avatar",children:(null===a||void 0===a?void 0:a.avatar)||"\ud83c\udf93"}),(0,c.jsxs)("div",{className:"user-details",children:[(0,c.jsx)("div",{className:"user-name",children:(null===a||void 0===a?void 0:a.name)||"Student"}),(0,c.jsxs)("div",{className:"user-meta",children:[(null===a||void 0===a?void 0:a.studentId)&&(0,c.jsxs)("span",{children:["ID: ",a.studentId]}),(null===a||void 0===a?void 0:a.department)&&(0,c.jsx)("span",{className:"user-dept",children:a.department})]})]})]}),s&&(0,c.jsxs)("div",{className:"overall-progress-section",children:[(0,c.jsxs)("div",{className:"progress-text",children:["Overall Progress: ",s.current," / ",s.total]}),(0,c.jsx)("div",{className:"progress-bar-container",children:(0,c.jsx)("div",{className:"progress-bar-fill",style:{width:"".concat(s.current/s.total*100,"%")}})})]}),(0,c.jsxs)("div",{className:"stats-row",children:[(0,c.jsxs)("div",{className:"stat-box",children:[(0,c.jsx)("div",{className:"stat-icon",children:"\u2b50"}),(0,c.jsx)("div",{className:"stat-value",children:(null===t||void 0===t?void 0:t.level)||1}),(0,c.jsx)("div",{className:"stat-label",children:"Level"})]}),(0,c.jsxs)("div",{className:"stat-box",children:[(0,c.jsx)("div",{className:"stat-icon",children:"\ud83d\udcaf"}),(0,c.jsx)("div",{className:"stat-value",children:(null===t||void 0===t?void 0:t.experience)||0}),(0,c.jsx)("div",{className:"stat-label",children:"EXP"})]}),(0,c.jsxs)("div",{className:"stat-box",children:[(0,c.jsx)("div",{className:"stat-icon",children:"\ud83d\udd25"}),(0,c.jsx)("div",{className:"stat-value",children:(null===t||void 0===t?void 0:t.streak)||0}),(0,c.jsx)("div",{className:"stat-label",children:"Streak"})]}),(0,c.jsxs)("div",{className:"stat-box",children:[(0,c.jsx)("div",{className:"stat-icon",children:"\ud83e\ude99"}),(0,c.jsx)("div",{className:"stat-value",children:(null===t||void 0===t?void 0:t.coins)||0}),(0,c.jsx)("div",{className:"stat-label",children:"Coins"})]})]})]})};var u=a(339);const v=e=>e?Array.isArray(e)?e:e.split(/[\|,]/g).map(e=>e.trim()).filter(e=>e.length>0):[];function m(e){var s,a;let{onComplete:m}=e;const{user:h,answerQuestion:x}=(0,r.A)(),[j,N]=(0,l.useState)([]),[g,p]=(0,l.useState)(!0),[y,b]=(0,l.useState)(""),[k,f]=(0,l.useState)(0),[A,q]=(0,l.useState)({}),[S,w]=(0,l.useState)(Date.now()),C=(null===h||void 0===h?void 0:h.language)||"en";(0,l.useEffect)(()=>{(async()=>{try{p(!0);const e=(0,n.P)((0,n.rJ)(i.db,"questions"),(0,n.My)("id")),s=(await(0,n.GG)(e)).docs.map(e=>(0,t.A)({docId:e.id},e.data()));N(s),s.length>0&&b(s[0].category)}catch(e){console.error("\u274c Failed to load questions:",e),u.Ay.error("Failed to load questions")}finally{p(!1),w(Date.now())}})()},[]);const I=(0,l.useMemo)(()=>[...new Set(j.map(e=>e.category))],[j]),D=(0,l.useMemo)(()=>j.filter(e=>e.category===y),[j,y]),P=D.length>0?D[k]:null,J={current:Object.keys(A).length,total:j.length},O=()=>{const e=k+1;if(e<D.length)return f(e),void w(Date.now());u.Ay.success("\ud83c\udf89 ".concat(y," Completed!"));const s=new Set(Object.keys(A)),a=I.filter(e=>j.some(a=>a.category===e&&!s.has(a.docId)));if(a.length>0)return b(a[0]),f(0),void w(Date.now());u.Ay.success("\ud83c\udfaf All survey completed!"),m&&m()};if(g||!P)return(0,c.jsx)("div",{className:"survey-container",children:(0,c.jsx)("div",{className:"loading-screen",children:"Loading questions..."})});const _={text:(null===(s=P.text)||void 0===s?void 0:s[C])||(null===(a=P.text)||void 0===a?void 0:a.en),section:P.category,type:P.type,options:v(P.options)};return(0,c.jsxs)("div",{className:"survey-container",children:[(0,c.jsx)(d,{overallProgress:J}),(0,c.jsx)(o,{question:_,questionNumber:k+1,totalQuestions:D.length,overallNumber:P?j.findIndex(e=>e.docId===P.docId)+1:0,overallTotal:j.length,onAnswer:e=>{if(!P)return;const s=(Date.now()-S)/1e3,a=P.docId;q(l=>(0,t.A)((0,t.A)({},l),{},{[a]:{value:e,timeSpent:s}})),x(s,"good"),O()},onSkip:()=>{if(!P)return;const e=P.docId;q(s=>(0,t.A)((0,t.A)({},s),{},{[e]:{value:null,skip:!0}})),O()},onBack:()=>{k>0?f(k-1):(0,u.Ay)("\u274c \uccab \ubc88\uc9f8 \ubb38\ud56d\uc785\ub2c8\ub2e4.")},onJump:()=>{const e=P.docId;q(s=>(0,t.A)((0,t.A)({},s),{},{[e]:{value:null,jump:!0}})),f(D.length-1)}})]})}}}]);
//# sourceMappingURL=471.d4a82d96.chunk.js.map